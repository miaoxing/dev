#!/bin/bash

set -e

# 如果没有忽略文件，拷贝默认配置
copied_ignore_file=false
if [[ ! -e ".stylelintignore" ]]; then
  cp "node_modules/@miaoxing/dev/.stylelintignore" ".stylelintignore";
  copied_ignore_file=true
fi

if [[ -e ".stylelintrc.json" ]]; then
 config=".stylelintrc.json";
else
 config="node_modules/@miaoxing/dev/.stylelintrc.json";
fi

if [[ $1 = 'fix' ]]; then
    fix="--fix"
else
    fix=""
fi

exit_code=0
yarn stylelint --allow-empty-input --config ${config} "**/*.{css,scss,sass}" ${fix} || exit_code=$?

# 还原拷贝的文件
if ${copied_ignore_file}; then
  rm ".stylelintignore"
fi

exit ${exit_code}
